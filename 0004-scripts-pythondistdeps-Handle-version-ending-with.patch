From ba077166b4d1f31afb059fd654c0288e1981f728 Mon Sep 17 00:00:00 2001
From: Gordon Messmer <gordon.messmer@gmail.com>
Date: Sun, 24 Nov 2019 16:35:22 -0800
Subject: [PATCH 4/5] scripts/pythondistdeps: Handle version ending with ".*"

(cherry picked from commit 18a3a046d0df8a26cca5a80b42a030b20b87da93)
---
 scripts/pythondistdeps.py | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/scripts/pythondistdeps.py b/scripts/pythondistdeps.py
index 9e3f36138..89c9a6183 100755
--- a/scripts/pythondistdeps.py
+++ b/scripts/pythondistdeps.py
@@ -255,6 +255,16 @@ for name in names:
                 next_ver[-1] = str(int(next_ver[-1]) + 1)
                 next_ver = '.'.join(next_ver)
                 spec_list.append('{n} >= {v} with {n} < {vnext}'.format(n=name, v=spec[1], vnext=next_ver))
+            elif spec[0] == '==' and spec[1].endswith('.*'):
+                # Parse the current version
+                next_ver = parse_version(spec[1]).base_version.split('.')
+                # Drop the micro version from both the version in spec and next_ver
+                next_ver = next_ver[0:-1]
+                spec = (spec[0], '.'.join(next_ver))
+                # Increment the minor version
+                next_ver[-1] = str(int(next_ver[-1]) + 1)
+                next_ver = '.'.join(next_ver)
+                spec_list.append('{n} >= {v} with {n} < {vnext}'.format(n=name, v=spec[1], vnext=next_ver))
             else:
                 spec_list.append('{} {} {}'.format(name, spec[0], spec[1]))
         print('(%s)' % ' with '.join(spec_list))
-- 
2.21.0

