From 76b9baeff098831f7f1c8b95a1d3b1604969852b Mon Sep 17 00:00:00 2001
From: Alexander Khryukin <alexander@mezon.ru>
Date: Fri, 7 Feb 2014 16:12:32 +0000
Subject: [PATCH] Add support of armv6j hardfloat for RaspberryPi port

---
 cpu-os-macros/armv6j-linux/macros  | 19 +++++++++++++++++++
 cpu-os-macros/armv6j-linux/macros~ | 19 +++++++++++++++++++
 macros/macros.rpmbuild             |  2 +-
 macros/macros.rpmbuild.in          |  2 +-
 4 files changed, 40 insertions(+), 2 deletions(-)
 create mode 100644 cpu-os-macros/armv6j-linux/macros
 create mode 100644 cpu-os-macros/armv6j-linux/macros~

diff --git a/cpu-os-macros/armv6j-linux/macros b/cpu-os-macros/armv6j-linux/macros
new file mode 100644
index 0000000..fdf5d5e
--- /dev/null
+++ b/cpu-os-macros/armv6j-linux/macros
@@ -0,0 +1,19 @@
+# Per-platform rpm configuration file.
+
+#==============================================================================
+# ---- per-platform macros.
+#
+%_arch			arm
+%_os			linux
+%_gnu			-gnueabi
+%optflags		 %{?__common_cflags_with_ssp:%{__common_cflags_with_ssp} -fPIC -g -march=armv6j -mfpu=vfp -mfloat-abi=hard}%{!?__common_cflags_with_ssp:-O2}
+
+#==============================================================================
+# ---- configure macros.
+#
+%_lib			lib
+
+#---------------------------------------------------------------------
+#	Multilibs
+%_multilibno		1
+%_multilibpatt		(/%{_lib}|/usr/%{_lib}(|/gconv)|/usr/local/%{_lib}|/usr/X11R6/%{_lib}|/opt/%{_lib})/[^/]*\\.([oa]|la|so[0-9.]*)$
diff --git a/cpu-os-macros/armv6j-linux/macros~ b/cpu-os-macros/armv6j-linux/macros~
new file mode 100644
index 0000000..10ffbbe
--- /dev/null
+++ b/cpu-os-macros/armv6j-linux/macros~
@@ -0,0 +1,19 @@
+# Per-platform rpm configuration file.
+
+#==============================================================================
+# ---- per-platform macros.
+#
+%_arch			arm
+%_os			linux
+%_gnu			-gnueabi
+%optflags		 %{?__common_cflags_with_ssp:%{__common_cflags_with_ssp} -fPIC -g -march=armv7-a -mfloat-abi=hard -mfpu=vfpv3-d16}%{!?__common_cflags_with_ssp:-O2}
+
+#==============================================================================
+# ---- configure macros.
+#
+%_lib			lib
+
+#---------------------------------------------------------------------
+#	Multilibs
+%_multilibno		1
+%_multilibpatt		(/%{_lib}|/usr/%{_lib}(|/gconv)|/usr/local/%{_lib}|/usr/X11R6/%{_lib}|/opt/%{_lib})/[^/]*\\.([oa]|la|so[0-9.]*)$
diff --git a/macros/macros.rpmbuild b/macros/macros.rpmbuild
index b772c52..b6b7835 100644
--- a/macros/macros.rpmbuild
+++ b/macros/macros.rpmbuild
@@ -647,7 +647,7 @@ done \
 %efi %{ix86} x86_64 ia64
 
 # same thing for arm
-%arm    arm armv3 armv3l armv3b armv4 armv4l armv4b armv5 armv5l armv5b armv5te armv5tel armv5teb xscale armv6 armv6l armv7l armv7hl armv7lh armv7hln armv7hnl armv7lhn armv7lnh armv7nhl armv7nlh
+%arm    arm armv3 armv3l armv3b armv4 armv4l armv4b armv5 armv5l armv5b armv5te armv5tel armv5teb xscale armv6 armv6l armv6j armv7l armv7hl armv7lh armv7hln armv7hnl armv7lhn armv7lnh armv7nhl armv7nlh
 
 # same thing for leg
 %leg    leg legv3 legv3l legv3b legv4 legv4l legv4b legv5 legv5l legv5b legv5te legv5tel legv5teb xscale legv6 legv6l legv7l legv7hl legv7lh legv7hln legv7hnl legv7lhn legv7lnh legv7nhl legv7nlh
diff --git a/macros/macros.rpmbuild.in b/macros/macros.rpmbuild.in
index ebfedb8..f87548e 100644
--- a/macros/macros.rpmbuild.in
+++ b/macros/macros.rpmbuild.in
@@ -680,7 +680,7 @@ done \
 %efi %{ix86} x86_64 ia64
 
 # same thing for arm
-%arm    arm armv3 armv3l armv3b armv4 armv4l armv4b armv5 armv5l armv5b armv5te armv5tel armv5teb xscale armv6 armv6l armv7l armv7hl armv7lh armv7hln armv7hnl armv7lhn armv7lnh armv7nhl armv7nlh
+%arm    arm armv3 armv3l armv3b armv4 armv4l armv4b armv5 armv5l armv5b armv5te armv5tel armv5teb xscale armv6 armv6l armv6j armv7l armv7hl armv7lh armv7hln armv7hnl armv7lhn armv7lnh armv7nhl armv7nlh
 
 # same thing for leg
 %leg    leg legv3 legv3l legv3b legv4 legv4l legv4b legv5 legv5l legv5b legv5te legv5tel legv5teb xscale legv6 legv6l legv7l legv7hl legv7lh legv7hln legv7hnl legv7lhn legv7lnh legv7nhl legv7nlh
-- 
1.8.5.3

