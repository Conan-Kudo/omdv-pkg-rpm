--- rpm-5.4.10/build/build.c.doc_post~	2013-01-06 21:13:34.043848352 +0100
+++ rpm-5.4.10/build/build.c	2013-01-06 21:13:36.623896063 +0100
@@ -181,9 +181,9 @@ rpmRC doScript(Spec spec, int what, cons
 	break;
     case RPMBUILD_STRINGBUF:
     default:
-	mTemplate = "%{___build_template}";
-	mPost = "%{___build_post}";
-	mCmd = "%{___build_cmd}";
+	mTemplate = "%{__spec_stringbuf_template}";
+	mPost = "%{__spec_stringbuf_post}";
+	mCmd = "%{__spec_stringbuf_cmd}";
 	break;
     }
 
--- rpm-5.4.10/macros/macros.rpmbuild.in.doc_post~	2013-01-06 21:10:57.440959259 +0100
+++ rpm-5.4.10/macros/macros.rpmbuild.in	2013-01-06 21:14:58.814412454 +0100
@@ -411,6 +411,22 @@ echo "Patch #%{__patch_number} (%{basena
 #%{__spec_install_post}\
 #%{nil}
 
+%__spec_stringbuf_shell	%{___build_shell}
+%__spec_stringbuf_args	%{___build_args}
+%__spec_stringbuf_cmd	%{___build_cmd}
+%__spec_stringbuf_pre	%{___build_pre}
+%__spec_stringbuf_body	%{___build_body}
+%__spec_stringbuf_post\
+%{?__os_stringbuf_post}\
+%{nil}
+%__spec_stringbuf_template	#!%{__spec_stringbuf_shell}\
+%{__spec_stringbuf_pre}\
+%{nil}
+
+#%{__spec_stringbuf_body}\
+#%{__spec_stringbuf_post}\
+#%{nil}
+
 %__spec_check_shell	%{___build_shell}
 %__spec_check_args	%{___build_args}
 %__spec_check_cmd	%{___build_cmd}
--- rpm-5.4.10/macros/mandriva.in.doc_post~	2013-01-06 21:11:04.693093423 +0100
+++ rpm-5.4.10/macros/mandriva.in	2013-01-06 21:13:00.334226587 +0100
@@ -332,6 +332,11 @@ GCONF_CONFIG_SOURCE=`%{_gconftool_bin} -
     %{?__spec_helper_post}%{?!__spec_helper_post:/usr/share/spec-helper/spec-helper} \
 %{nil}
 
+# $DONT_FIX_EOL prolly' won't be of any use as it won' be set in the same shell...
+%__os_stringbuf_post    \
+    %{?!dont_fix_eol:         [ -n "$DONT_FIX_EOL" ]        || %_spec_helper_dir/fix_eol} \
+%{nil}
+
 #==============================================================================
 # ---- specfile macros.
 #	Macro(s) here can be used reliably for reproducible builds.
